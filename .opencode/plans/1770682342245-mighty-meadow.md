# Fix: npm Trusted Publishing Provenance Failure for Platform Packages

## Problem

The `version.yml` workflow fails at the publish step with:

```
npm error 422 Unprocessable Entity - Error verifying sigstore provenance bundle:
Failed to validate repository information: package.json: "repository.url" is "",
expected to match "https://github.com/eli0shin/cli-lsp-client" from provenance
```

When npm publishes with `NPM_CONFIG_PROVENANCE=true` (trusted publishing), sigstore verification requires `package.json`'s `repository.url` to match the GitHub repository from the OIDC token. The platform-specific packages (e.g., `cli-lsp-client-windows-x64`) are generated without a `repository` field.

## Root Cause

`script/build.ts:32-43` generates platform package.json with only `name`, `version`, `os`, `cpu` — no `repository` field.

The main package in `script/release.ts:210` correctly includes `repository: pkg.repository`, but the platform packages do not.

## Fix

### File: `script/build.ts`

Add the `repository` field to the platform-specific package.json (line 33-39). Change from:

```ts
{
  name,
  version,
  os: [os === 'windows' ? 'win32' : os],
  cpu: [arch],
}
```

To:

```ts
{
  name,
  version,
  os: [os === 'windows' ? 'win32' : os],
  cpu: [arch],
  repository: pkg.repository,
}
```

`pkg` is already imported at line 4: `import pkg from '../package.json'`

That's the entire fix — one field addition.

## Verification

1. Run `bun run build` to confirm it builds successfully
2. Inspect a generated platform package.json (e.g., `dist/cli-lsp-client-darwin-arm64/package.json`) to confirm it contains the `repository` field with `{ "type": "git", "url": "git+https://github.com/eli0shin/cli-lsp-client.git" }`
3. After merge to `main`, the `version.yml` workflow should publish successfully
